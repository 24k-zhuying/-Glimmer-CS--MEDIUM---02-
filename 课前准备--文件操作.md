* 做题历程
刚开始看到是课前准备，以为会很ez，但最后却花了我四个多小时（还不包括学习时间呜呜呜），问题主要有==审题方面==：审题的花了较长时间去弄懂到底该如何去操作（现在也不是很清楚我进行的操作到底对不对），==做题方面==：做题时在文件方面的函数老是忘记其具体用法因此经常去查，做题的思路花费了大部分时间不仅要想清楚思路还要一步一步捋清楚，另外还有用double存储数据时后面老是会有多余的0，我想了很久去解决但最后还是只用出了最朴素的方式去解决（想不到其他的了，问了ai它的方法也不适用），中间还有许许多多的小困难也花费了很多时间:sob::sob::sob::sob::sob:

```c
#include <stdio.h>
#include <math.h>
#include <string.h>
//将二进制转化为十进制的函数
void twoToTen(char *two, char *resultNums);
//用于去除数据末尾多余的0
void removeZero(char *str);

int main(){
    //打开原始文件CS_M_02.txt用于读取，如果打开失败则输出错误信息并返回
    FILE *mainFile = fopen("./files/CS_M_02.txt", "r");

    if(mainFile == NULL){
        perror("file open failed:");
        return 0;
    }
    //打开临时文件temp.txt用于写入，如果打开失败则关闭原始文件并输出错误信息返回
    FILE *tempFile = fopen("./files/temp.txt", "w");
    if (tempFile == NULL) {
        fclose(mainFile);
        perror("Error opening temporary file");
        return 1;
    }
    //用于逐行读取原始文件内容
    char tempStr[20] = {0};
    //逐行读取文本内容
    while (fgets(tempStr, sizeof(tempStr), mainFile)!= NULL) {
        // 去除读取字符串中的换行符
        tempStr[strcspn(tempStr, "\n")] = '\0';
        //记录读取到的字符串长度
        int len = strlen(tempStr);
        //如果该行时二进制数字
        if( tempStr[len-1] == 'B' ){
            //临时存储浮点数的字符串，用于传入函数计算
            char tempNum[20] = {0};
            //存储最终结果的字符串
            char resultNums[20] = {0};
            //提取字符串中的浮点数
            double nums;
            //记录该行前面的操作符
            char fuhao;
            //提取字符串中的浮点数和操作符
            sscanf(tempStr,"%c%*[ ]%lf%*[B]",&fuhao,&nums);
            //将提取的浮点数存入字符串中用于计算
            sprintf(tempNum,"%f",nums);
            //进行计算
            twoToTen(tempNum, resultNums);
            //记录计算后的数字长度
            int lenNums = strlen(resultNums);
            //去掉数据小数点后面多余的0(未用函数是因为后续操作会需要该步)
            int i = 0;          
            for (i = lenNums-1;; i--)
            {
                if(resultNums[i] != '0'){                   
                    break;
                }
            }
            resultNums[i+3] = '\0';
            for(int j =i;j>=0;j--){
                resultNums[j+2] = resultNums[j];
            }
            //将字符串往后移两位将操作符和空格符存入字符串
            //使整体结构与最开始的字符串相同
            resultNums[0] = fuhao;
            resultNums[1] = ' ';
            //在字符串最后加上‘D’表示十进制和换行符 
            fprintf(tempFile, "%sD\n", resultNums);          
        }
        //如果是十进制时
        else{
            fprintf(tempFile, "%s\n", tempStr);
        }               
    }
    //关闭文件
    fclose(mainFile);
    fclose(tempFile);
    //将更改后的文件替换更改前的文件
    remove("./files/CS_M_02.txt");
    rename("./files/temp.txt", "./files/CS_M_02.txt");

//抓取定点数并输出
    FILE *file = fopen("./files/CS_M_02.txt", "r");
    if (file == NULL) {
        perror("Error opening temporary file");
        return 1;
    }
    //用于存储结果
    double num;
    char putNums[20];

    while (fgets(putNums, sizeof(putNums), file)!= NULL) {
        //若读取的该行没有操作符即第一行
        if (sscanf(putNums, "%lf", &num) == 1) {
            //存储结果的字符串用于后续去掉多余的0
            char outputStr[20];
            sprintf(outputStr, "%lf", num);
            //去掉末尾多余的0
            removeZero(outputStr);
            printf("%s\n", outputStr);
        }
        //若读取的该行有操作符即不是第一行
        if (sscanf(putNums, "%*[-+*]%*[ ]%lf%*[D]", &num) == 1) {
            //存储结果的字符串用于后续去掉多余的0
            char outputStr[20];
            sprintf(outputStr, "%lf", num);
            //去掉末尾多余的0
            removeZero(outputStr);
            printf("%s\n", outputStr);
        }
    }


    fclose(file);

    return 0;
}
//将二进制转化为十进制的函数
void twoToTen(char *two, char *resultNums) {
    int len = strlen(two);
    int dotPos = -1;
    // 查找小数点位置
    for (int i = 0; i < len; i++) {
        if (two[i] == '.') {
            dotPos = i;
            break;
        }
    }
    double ten = 0;
    if (dotPos == -1) {
        // 如果没有小数点，按照整数转换
        for (int i = 0; len - i - 1 >= 0; i++) {
            if (two[i] == '1') {
                ten += pow(2, len - i - 1);
            }
        }
    } else {
        // 处理整数部分
        for (int i = 0; i < dotPos; i++) {
            if (two[i] == '1') {
                ten += pow(2, dotPos - i - 1);
            }
        }
        // 处理小数部分
        for (int i = dotPos + 1; i < len; i++) {
            if (two[i] == '1') {
                ten += pow(2, dotPos - i);
            }
        }
    }
    //将结果保存在字符串中
    sprintf(resultNums,"%f",ten);

    return;
}
//用于去除数据末尾多余的0
void removeZero(char *str) {
    // 计算字符串长度
    int len = strlen(str);
    // 当字符串长度大于1且最后一个字符是0时
    while (len > 1 && str[len - 1] == '0') {
        // 将最后一个字符置为空字符（即删除该字符）
        str[len - 1] = '\0';
        // 字符串长度减1
        len--;
    }
    // 如果最后一个字符是小数点
    if (str[len - 1] == '.') {
        // 将最后一个字符置为空字符（即删除该字符）
        str[len - 1] = '\0';
    }
}
```